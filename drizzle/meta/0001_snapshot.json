{
  "id": "95044b7c-4fe8-4de8-aefb-4bf0eac95823",
  "prevId": "ad922eb8-eb46-46c3-82c7-6d43cf64c663",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.github_installations": {
      "name": "github_installations",
      "schema": "",
      "columns": {
        "installation_id": {
          "name": "installation_id",
          "type": "integer",
          "primaryKey": true,
          "notNull": true
        },
        "account_login": {
          "name": "account_login",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "account_type": {
          "name": "account_type",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "installed_at": {
          "name": "installed_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true
        },
        "suspended_at": {
          "name": "suspended_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": false
        },
        "app_slug": {
          "name": "app_slug",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'towns-github-bot'"
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {
        "account_type_check": {
          "name": "account_type_check",
          "value": "\"github_installations\".\"account_type\" IN ('Organization', 'User')"
        }
      },
      "isRLSEnabled": false
    },
    "public.github_subscriptions": {
      "name": "github_subscriptions",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "space_id": {
          "name": "space_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "channel_id": {
          "name": "channel_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "repo_full_name": {
          "name": "repo_full_name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "delivery_mode": {
          "name": "delivery_mode",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "is_private": {
          "name": "is_private",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true
        },
        "created_by_towns_user_id": {
          "name": "created_by_towns_user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_by_github_login": {
          "name": "created_by_github_login",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "installation_id": {
          "name": "installation_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "enabled": {
          "name": "enabled",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": true
        },
        "event_types": {
          "name": "event_types",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'pr,issues,commits,releases'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {
        "github_subscriptions_unique_idx": {
          "name": "github_subscriptions_unique_idx",
          "columns": [
            {
              "expression": "space_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "channel_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "repo_full_name",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "idx_github_subscriptions_channel": {
          "name": "idx_github_subscriptions_channel",
          "columns": [
            {
              "expression": "channel_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "idx_github_subscriptions_repo": {
          "name": "idx_github_subscriptions_repo",
          "columns": [
            {
              "expression": "repo_full_name",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "github_subscriptions_created_by_towns_user_id_github_user_tokens_towns_user_id_fk": {
          "name": "github_subscriptions_created_by_towns_user_id_github_user_tokens_towns_user_id_fk",
          "tableFrom": "github_subscriptions",
          "tableTo": "github_user_tokens",
          "columnsFrom": [
            "created_by_towns_user_id"
          ],
          "columnsTo": [
            "towns_user_id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "github_subscriptions_installation_id_github_installations_installation_id_fk": {
          "name": "github_subscriptions_installation_id_github_installations_installation_id_fk",
          "tableFrom": "github_subscriptions",
          "tableTo": "github_installations",
          "columnsFrom": [
            "installation_id"
          ],
          "columnsTo": [
            "installation_id"
          ],
          "onDelete": "set null",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {
        "delivery_mode_check": {
          "name": "delivery_mode_check",
          "value": "\"github_subscriptions\".\"delivery_mode\" IN ('webhook', 'polling')"
        }
      },
      "isRLSEnabled": false
    },
    "public.github_user_tokens": {
      "name": "github_user_tokens",
      "schema": "",
      "columns": {
        "towns_user_id": {
          "name": "towns_user_id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "github_user_id": {
          "name": "github_user_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "github_login": {
          "name": "github_login",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "access_token": {
          "name": "access_token",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "token_type": {
          "name": "token_type",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "scope": {
          "name": "scope",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token": {
          "name": "refresh_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token_expires_at": {
          "name": "refresh_token_expires_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {
        "github_user_tokens_github_user_id_unique": {
          "name": "github_user_tokens_github_user_id_unique",
          "columns": [
            {
              "expression": "github_user_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.installation_repositories": {
      "name": "installation_repositories",
      "schema": "",
      "columns": {
        "installation_id": {
          "name": "installation_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "repo_full_name": {
          "name": "repo_full_name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "added_at": {
          "name": "added_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {
        "idx_installation_repos_by_name": {
          "name": "idx_installation_repos_by_name",
          "columns": [
            {
              "expression": "repo_full_name",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "idx_installation_repos_by_install": {
          "name": "idx_installation_repos_by_install",
          "columns": [
            {
              "expression": "installation_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "installation_repositories_installation_id_github_installations_installation_id_fk": {
          "name": "installation_repositories_installation_id_github_installations_installation_id_fk",
          "tableFrom": "installation_repositories",
          "tableTo": "github_installations",
          "columnsFrom": [
            "installation_id"
          ],
          "columnsTo": [
            "installation_id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {
        "installation_repositories_installation_id_repo_full_name_pk": {
          "name": "installation_repositories_installation_id_repo_full_name_pk",
          "columns": [
            "installation_id",
            "repo_full_name"
          ]
        }
      },
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.oauth_states": {
      "name": "oauth_states",
      "schema": "",
      "columns": {
        "state": {
          "name": "state",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "towns_user_id": {
          "name": "towns_user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "channel_id": {
          "name": "channel_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "space_id": {
          "name": "space_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "redirect_action": {
          "name": "redirect_action",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "redirect_data": {
          "name": "redirect_data",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {
        "idx_oauth_states_expires": {
          "name": "idx_oauth_states_expires",
          "columns": [
            {
              "expression": "expires_at",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "idx_oauth_states_towns_user_id": {
          "name": "idx_oauth_states_towns_user_id",
          "columns": [
            {
              "expression": "towns_user_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.repo_polling_state": {
      "name": "repo_polling_state",
      "schema": "",
      "columns": {
        "repo": {
          "name": "repo",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "etag": {
          "name": "etag",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "last_event_id": {
          "name": "last_event_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "last_polled_at": {
          "name": "last_polled_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": false
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.webhook_deliveries": {
      "name": "webhook_deliveries",
      "schema": "",
      "columns": {
        "delivery_id": {
          "name": "delivery_id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "installation_id": {
          "name": "installation_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "event_type": {
          "name": "event_type",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "delivered_at": {
          "name": "delivered_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true
        },
        "status": {
          "name": "status",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'pending'"
        },
        "error": {
          "name": "error",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "retry_count": {
          "name": "retry_count",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        }
      },
      "indexes": {
        "idx_deliveries_status": {
          "name": "idx_deliveries_status",
          "columns": [
            {
              "expression": "status",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "delivered_at",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {
        "status_check": {
          "name": "status_check",
          "value": "\"webhook_deliveries\".\"status\" IN ('pending', 'success', 'failed')"
        }
      },
      "isRLSEnabled": false
    }
  },
  "enums": {},
  "schemas": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "views": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}